{% extends 'base.html' %}
{% load static %}

{% block title %}–ì–ª–∞–≤–Ω–∞—è - Engine View{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12 text-center mb-5">
        <h1 class="display-4 mb-3">üö¢ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Engine View!</h1>
        <p class="lead">–°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Å—É–¥–æ–≤—ã—Ö –¥–≤–∏–≥–∞—Ç–µ–ª–µ–π</p>
    </div>
</div>

<!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
{% if vessels %}
<div class="row mb-5">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h4 class="mb-0">üìà –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h4>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-3 col-6 text-center">
                        <div class="p-3 border rounded">
                            <h3 class="text-primary">{{ vessels_count }}</h3>
                            <p class="mb-0 text-muted">–°—É–¥–æ–≤ –≤ —Å–∏—Å—Ç–µ–º–µ</p>
                        </div>
                    </div>
                    <div class="col-md-3 col-6 text-center">
                        <div class="p-3 border rounded">
                            <h3 class="text-success">{{ engines_count }}</h3>
                            <p class="mb-0 text-muted">–î–≤–∏–≥–∞—Ç–µ–ª–µ–π</p>
                        </div>
                    </div>
                    <div class="col-md-3 col-6 text-center">
                        <div class="p-3 border rounded">
                            <h3 class="text-warning">{{ measurements_count }}</h3>
                            <p class="mb-0 text-muted">–ó–∞–º–µ—Ä–æ–≤</p>
                        </div>
                    </div>
                    <div class="col-md-3 col-6 text-center">
                        <div class="p-3 border rounded">
                            <h3 class="text-info">
                                {% if last_measurement_date %}
                                    {{ last_measurement_date|date:"d.m.Y" }}
                                {% else %}
                                    –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö
                                {% endif %}
                            </h3>
                            <p class="mb-0 text-muted">–ü–æ—Å–ª–µ–¥–Ω–∏–π –∑–∞–º–µ—Ä</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endif %}

<!-- –°–ø–∏—Å–æ–∫ —Å—É–¥–æ–≤ -->
{% if vessels %}
<div class="row mb-4">
    <div class="col-12">
        <h3 class="mb-4">‚öì –°—É–¥–Ω–∞ –≤ —Å–∏—Å—Ç–µ–º–µ</h3>
        <div class="row">
            {% for vessel in vessels %}
            <div class="col-xl-3 col-md-6 mb-4">
                <div class="card h-100 shadow-sm">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0">{{ vessel.name }}</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-2">
                            <strong>IMO:</strong> {{ vessel.imo_number }}
                        </div>
                        <div class="mb-3">
                            <strong>–î–≤–∏–≥–∞—Ç–µ–ª–µ–π:</strong> {{ vessel.engines.count }}
                        </div>
                        {% if vessel.last_measurement %}
                        <div class="small text-muted">
                            –ü–æ—Å–ª–µ–¥–Ω–∏–π –∑–∞–º–µ—Ä: {{ vessel.last_measurement.timestamp|date:"d.m.Y H:i" }}
                        </div>
                        {% else %}
                        <div class="small text-muted">
                            –ó–∞–º–µ—Ä–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç
                        </div>
                        {% endif %}
                    </div>
                    <div class="card-footer bg-transparent">
                        <a href="{% url 'monitoring:measurement_list' %}?vessel={{ vessel.id }}" 
                           class="btn btn-sm btn-outline-primary w-100">
                            üìä –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –¥–∞–Ω–Ω—ã–µ
                        </a>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>
{% endif %}

<!-- –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h4 class="mb-0">‚ö° –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h4>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-3 mb-3">
                        <a href="{% url 'monitoring:measurement_list' %}" class="btn btn-primary w-100 py-3">
                            üìã –í—Å–µ –∑–∞–º–µ—Ä—ã
                        </a>
                    </div>
                    <div class="col-md-3 mb-3">
                        <a href="{% url 'monitoring:trends' %}" class="btn btn-info w-100 py-3">
                            üìä –ì—Ä–∞—Ñ–∏–∫–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
                        </a>
                    </div>
                    <div class="col-md-3 mb-3">
                        <a href="{% url 'monitoring:vessel_engine_stats' %}" class="btn btn-warning w-100 py-3">
                            üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
                        </a>
                    </div>
                    <div class="col-md-3 mb-3">
                        {% if user.is_staff %}
                        <a href="{% url 'admin:index' %}" class="btn btn-outline-secondary w-100 py-3">
                            ‚öôÔ∏è –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
                        </a>
                        {% else %}
                        <a href="{% url 'monitoring:measurement_list' %}" class="btn btn-success w-100 py-3">
                            üîç –ü–æ–∏—Å–∫ –¥–∞–Ω–Ω—ã—Ö
                        </a>
                        {% endif %}
                    </div>
                </div>
                {% if user.is_authenticated and user.is_staff %}
                <div class="row mt-3">
                    <div class="col-12">
                        <div class="text-center">
                            <a href="{% url 'monitoring:create_measurement' %}" class="btn btn-success me-2">
                                ‚ûï –î–æ–±–∞–≤–∏—Ç—å –∑–∞–º–µ—Ä
                            </a>
                            <a href="{% url 'admin:monitoring_parametertype_add' %}" class="btn btn-outline-primary me-2">
                                ‚öôÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
                            </a>
                            <a href="{% url 'admin:monitoring_measurement_add' %}" class="btn btn-outline-info">
                                üì§ –ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
                            </a>
                            <a href="{% url 'monitoring:import_csv' %}" class="btn btn-success">
                                üì§ –ò–º–ø–æ—Ä—Ç CSV
                            </a>
                        </div>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

{% if not vessels %}
<div class="row mt-5">
    <div class="col-12 text-center">
        <div class="alert alert-info">
            <h4>üì≠ –î–∞–Ω–Ω—ã—Ö –ø–æ–∫–∞ –Ω–µ—Ç</h4>
            <p>–í —Å–∏—Å—Ç–µ–º–µ –µ—â–µ –Ω–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –æ —Å—É–¥–∞—Ö –∏ –∑–∞–º–µ—Ä–∞—Ö.</p>
            {% if user.is_staff %}
            <div class="mt-3">
                <a href="{% url 'admin:monitoring_vessel_add' %}" class="btn btn-primary me-2">
                    ‚ûï –î–æ–±–∞–≤–∏—Ç—å —Å—É–¥–Ω–æ
                </a>
                <a href="{% url 'admin:monitoring_engine_add' %}" class="btn btn-primary me-2">
                    üîß –î–æ–±–∞–≤–∏—Ç—å –¥–≤–∏–≥–∞—Ç–µ–ª—å
                </a>
                <a href="{% url 'admin:monitoring_measurement_add' %}" class="btn btn-success">
                    üì§ –ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
                </a>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endif %}
{% endblock %}