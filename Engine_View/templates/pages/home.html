{% extends 'base.html' %}
{% load static %}

{% block title %}–ì–ª–∞–≤–Ω–∞—è - Engine View ¬∑ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å—É–¥–æ–≤—ã—Ö –¥–≤–∏–≥–∞—Ç–µ–ª–µ–π{% endblock %}

{% block content %}
<!-- Hero Section -->
<div class="row mb-5">
    <div class="col-12 text-center mb-5">
        <div class="glass-effect rounded-3 p-5 mb-4">
            <h1 class="display-4 fw-bold mb-3">üö¢ Engine View</h1>
            <p class="lead fs-4 text-muted">–°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Å—É–¥–æ–≤—ã—Ö –¥–≤–∏–≥–∞—Ç–µ–ª–µ–π</p>
            <div class="mt-4">
                <span class="badge bg-primary me-2">Real-time</span>
                <span class="badge bg-success me-2">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</span>
                <span class="badge bg-info">–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å</span>
            </div>
        </div>
    </div>
</div>

<!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
{% if vessels %}
<div class="row mb-5">
    <div class="col-12">
        <div class="glass-effect rounded-3 p-4">
            <h3 class="mb-4"><i class="bi bi-graph-up"></i> –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã</h3>
            <div class="row g-3">
                <div class="col-md-3 col-6">
                    <div class="stat-card card text-center h-100">
                        <div class="card-body">
                            <i class="bi bi-ship display-6 text-primary mb-2"></i>
                            <h3 class="text-primary fw-bold">{{ vessels_count }}</h3>
                            <p class="text-muted mb-0">–°—É–¥–æ–≤ –≤ —Å–∏—Å—Ç–µ–º–µ</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 col-6">
                    <div class="stat-card card text-center h-100">
                        <div class="card-body">
                            <i class="bi bi-gear display-6 text-success mb-2"></i>
                            <h3 class="text-success fw-bold">{{ engines_count }}</h3>
                            <p class="text-muted mb-0">–î–≤–∏–≥–∞—Ç–µ–ª–µ–π</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 col-6">
                    <div class="stat-card card text-center h-100">
                        <div class="card-body">
                            <i class="bi bi-collection display-6 text-warning mb-2"></i>
                            <h3 class="text-warning fw-bold">{{ measurements_count }}</h3>
                            <p class="text-muted mb-0">–ó–∞–º–µ—Ä–æ–≤</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 col-6">
                    <div class="stat-card card text-center h-100">
                        <div class="card-body">
                            <i class="bi bi-clock-history display-6 text-info mb-2"></i>
                            <h3 class="text-info fw-bold">
                                {% if last_measurement_date %}
                                    {{ last_measurement_date|date:"d.m.Y" }}
                                {% else %}
                                    –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö
                                {% endif %}
                            </h3>
                            <p class="text-muted mb-0">–ü–æ—Å–ª–µ–¥–Ω–∏–π –∑–∞–º–µ—Ä</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endif %}

<!-- –°–ø–∏—Å–æ–∫ —Å—É–¥–æ–≤ -->
{% if vessels %}
<div class="row mb-5">
    <div class="col-12">
        <div class="glass-effect rounded-3 p-4">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h3 class="mb-0"><i class="bi bi-list-ul"></i> –°—É–¥–Ω–∞ –≤ —Å–∏—Å—Ç–µ–º–µ</h3>
                <div class="input-group" style="max-width: 300px;">
                    <input type="text" class="form-control" placeholder="–ü–æ–∏—Å–∫ —Å—É–¥–Ω–∞..." id="vesselSearch">
                    <button class="btn btn-outline-primary" type="button">
                        <i class="bi bi-search"></i>
                    </button>
                </div>
            </div>
            <div class="row g-4" id="vesselList">
                {% for vessel in vessels %}
                <div class="col-xl-4 col-md-6">
                    <div class="vessel-card card h-100">
                        <div class="card-header bg-dark d-flex justify-content-between align-items-center">
                            <h5 class="mb-0 text-white">{{ vessel.name }}</h5>
                            <span class="badge bg-primary">{{ vessel.engines.count }} –¥–≤–∏–≥.</span>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <small class="text-muted">IMO –Ω–æ–º–µ—Ä</small>
                                <div class="fw-semibold">{{ vessel.imo_number }}</div>
                            </div>
                            {% if vessel.last_measurement %}
                            <div class="mb-3">
                                <small class="text-muted">–ü–æ—Å–ª–µ–¥–Ω–∏–π –∑–∞–º–µ—Ä</small>
                                <div class="text-success">
                                    <i class="bi bi-clock"></i> {{ vessel.last_measurement.timestamp|date:"d.m.Y H:i" }}
                                </div>
                            </div>
                            {% else %}
                            <div class="mb-3">
                                <small class="text-muted">–°—Ç–∞—Ç—É—Å</small>
                                <div class="text-warning">
                                    <i class="bi bi-exclamation-triangle"></i> –ó–∞–º–µ—Ä–æ–≤ –Ω–µ—Ç
                                </div>
                            </div>
                            {% endif %}
                        </div>
                        <div class="card-footer bg-transparent">
                            <a href="{% url 'monitoring:measurement_list' %}?vessel={{ vessel.id }}" 
                               class="btn btn-modern w-100">
                                <i class="bi bi-graph-up"></i> –ê–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö
                            </a>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>
{% endif %}

<!-- –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
<div class="row">
    <div class="col-12">
        <div class="glass-effect rounded-3 p-4">
            <h3 class="mb-4"><i class="bi bi-lightning"></i> –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h3>
            <div class="row g-3">
                <div class="col-lg-3 col-md-6">
                    <a href="{% url 'monitoring:measurement_list' %}" class="btn btn-primary w-100 py-3 d-flex align-items-center justify-content-center">
                        <i class="bi bi-table me-2"></i> –í—Å–µ –∑–∞–º–µ—Ä—ã
                    </a>
                </div>
                <div class="col-lg-3 col-md-6">
                    <a href="{% url 'monitoring:trends' %}" class="btn btn-success w-100 py-3 d-flex align-items-center justify-content-center">
                        <i class="bi bi-graph-up me-2"></i> –ì—Ä–∞—Ñ–∏–∫–∏
                    </a>
                </div>
                <div class="col-lg-3 col-md-6">
                    <a href="{% url 'monitoring:vessel_engine_stats' %}" class="btn btn-warning w-100 py-3 d-flex align-items-center justify-content-center">
                        <i class="bi bi-bar-chart me-2"></i> –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
                    </a>
                </div>
                <div class="col-lg-3 col-md-6">
                    {% if user.is_staff %}
                    <a href="{% url 'admin:index' %}" class="btn btn-outline-secondary w-100 py-3 d-flex align-items-center justify-content-center">
                        <i class="bi bi-gear me-2"></i> –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
                    </a>
                    {% else %}
                    <a href="{% url 'monitoring:measurement_list' %}" class="btn btn-info w-100 py-3 d-flex align-items-center justify-content-center">
                        <i class="bi bi-search me-2"></i> –ü–æ–∏—Å–∫ –¥–∞–Ω–Ω—ã—Ö
                    </a>
                    {% endif %}
                </div>
            </div>
            
            {% if user.is_authenticated and user.is_staff %}
            <div class="mt-4 pt-3 border-top">
                <h5 class="mb-3">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏</h5>
                <div class="row g-2">
                    <div class="col-auto">
                        <a href="{% url 'monitoring:create_measurement' %}" class="btn btn-outline-success">
                            <i class="bi bi-plus-circle"></i> –î–æ–±–∞–≤–∏—Ç—å –∑–∞–º–µ—Ä
                        </a>
                    </div>
                    <div class="col-auto">
                        <a href="{% url 'admin:monitoring_parametertype_add' %}" class="btn btn-outline-primary">
                            <i class="bi bi-sliders"></i> –ü–∞—Ä–∞–º–µ—Ç—Ä—ã
                        </a>
                    </div>
                    <div class="col-auto">
                        <a href="{% url 'monitoring:import_csv' %}" class="btn btn-outline-info">
                            <i class="bi bi-upload"></i> –ò–º–ø–æ—Ä—Ç CSV
                        </a>
                    </div>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>

{% if not vessels %}
<div class="row mt-5">
    <div class="col-12 text-center">
        <div class="glass-effect rounded-3 p-5">
            <i class="bi bi-database display-1 text-muted mb-3"></i>
            <h3 class="text-muted">–î–∞–Ω–Ω—ã—Ö –ø–æ–∫–∞ –Ω–µ—Ç</h3>
            <p class="text-muted mb-4">–í —Å–∏—Å—Ç–µ–º–µ –µ—â–µ –Ω–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –æ —Å—É–¥–∞—Ö –∏ –∑–∞–º–µ—Ä–∞—Ö.</p>
            {% if user.is_staff %}
            <div class="d-flex justify-content-center gap-3 flex-wrap">
                <a href="{% url 'admin:monitoring_vessel_add' %}" class="btn btn-modern">
                    <i class="bi bi-plus-circle"></i> –î–æ–±–∞–≤–∏—Ç—å —Å—É–¥–Ω–æ
                </a>
                <a href="{% url 'admin:monitoring_engine_add' %}" class="btn btn-primary">
                    <i class="bi bi-gear"></i> –î–æ–±–∞–≤–∏—Ç—å –¥–≤–∏–≥–∞—Ç–µ–ª—å
                </a>
                <a href="{% url 'admin:monitoring_measurement_add' %}" class="btn btn-success">
                    <i class="bi bi-upload"></i> –ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
                </a>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endif %}

<!-- JavaScript –¥–ª—è –ø–æ–∏—Å–∫–∞ -->
<script>
    document.getElementById('vesselSearch').addEventListener('input', function(e) {
        const searchTerm = e.target.value.toLowerCase();
        const vessels = document.querySelectorAll('.vessel-card');
        
        vessels.forEach(vessel => {
            const vesselName = vessel.querySelector('.card-header h5').textContent.toLowerCase();
            if (vesselName.includes(searchTerm)) {
                vessel.style.display = 'block';
            } else {
                vessel.style.display = 'none';
            }
        });
    });
</script>
{% endblock %}